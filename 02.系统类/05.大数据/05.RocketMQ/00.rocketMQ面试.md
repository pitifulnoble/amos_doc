## 问题

为什么要使用消息队列？ 

如何保证消息的顺序性？ 

如何避免消息重复消费？ 

大量消息在 MQ 里长时间积压，该如何解决？ 

MQ 中的消息过期失效了怎么办？

## 为什么要使用消息队列？ 
和kafka基本同理。

**生产者端保证顺序性：分区（队列）层面的顺序性**

原理：
RocketMQ 中的主题（Topic）可以包含多个队列（Queue），类似于 Kafka 中的分区概念。消息在发送到主题时，会根据一定的规则被分配到不同的队列中。在每个队列内部，消息是按照发送的先后顺序进行存储和消费的，从而保证了队列层面的消息顺序性。
例如，当生产者向一个名为 “orderTopic” 的主题发送订单相关消息时，如果以订单 ID 为依据进行队列分配（如通过订单 ID 的哈希值对队列数量取模来确定具体队列），那么同一个订单的所有消息就会被发送到同一个队列中，该队列内这些与同一订单相关的消息就会保持顺序性。

**消费者端保证顺序性**
RocketMQ 提供了一些消费模式来控制消息的消费顺序。例如，它支持顺序消费模式（ConsumeOrderly），在这种模式下，消费者组中的每个消费者会按照队列的顺序依次从队列中获取消息，并在获取到消息后进行相应的业务处理。消费者在处理消息时，必须按照获取到的消息顺序依次进行，不能出现跳跃式处理，从而保证了整个消费者组在处理与队列相关的消息时的顺序性。

**其他注意事项**

避免跨队列依赖：
要保证消息的顺序性，应尽量避免业务逻辑上存在对跨队列消息顺序的依赖。因为不同队列之间的消息是并行处理的，无法天然保证跨队列消息的顺序。如果确实存在这种情况，可能需要在应用层通过额外的逻辑来协调和处理，比如等待所有相关队列的特定消息都到达后再进行统一的业务处理等。

**如何避免消息重复消费**
和kafka同理，也是幂等开关控制。
消费者同样可以在offset、缓存处理做文章
